<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuevo Vehiculo</title>
    <link rel="stylesheet" href="../styles.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="container">
        <div class="vehiculo title">
            <h1>Nuevo Vehiculo</h1>
        </div>
        <div class="vehiculo body">
            <form onSubmit="crearVehiculo(event)">
                <input type="text" id="marcaInput" placeholder="Nombre de la Marca..." required>

                <input type="text" id="modeloInput" placeholder="Nombre de el Modelo..." required>

                <input type="number" min="1900" max="2100" step="1" id="anyo" minlength="4" maxlength="4" placeholder="Año de Fabricacion..." required>

                <input type="text" id="tipo" placeholder="Tipo de Vehiculo..." required>

                <input type="text" id="kilometraje" onfocus="quitarFormato(this)" onblur="formatearNumero(this)" placeholder="Kilometraje..." required>

                <input type="text" id="precio" onfocus="quitarFormato(this)"  onblur="formatearNumero(this, true)" placeholder="Precio..." required>

                <input type="text" id="imagen" placeholder="Imagen..." required>

                <button type="submit" class="btn-detalles">Guardar</button>
            </form>
        </div>
    </div>
    <script>
        function quitarFormato(input) {
            // Quita los puntos y el símbolo de euro para permitir la edición
            input.value = input.value.replace(/\./g, "").replace(/\s?€/g, "");
        }

        function formatearNumero(input, esPrecio = false) {
            let valor = input.value.replace(/\D/g, ""); // Elimina todo lo que no sea número

            if (valor) {
                // Aplica puntos de miles
                valor = Number(valor).toLocaleString("es-ES");
                if (esPrecio) valor += " €"; // Añade el símbolo € si es un precio
            }

            input.value = valor;
        }


        function crearVehiculo(e){
            e.preventDefault()
            const marca = document.getElementById("marcaInput").value
            const modelo = document.getElementById("modeloInput").value
            const anyo = document.getElementById("anyo").value
            const tipo = document.getElementById("tipo").value
            const kilometraje = parseFloat(document.getElementById("kilometraje").value.replace(/\./g, "").replace(/\s?€/g, ""))//Eliminamos los . y € y lo convertimos a float
            const precio = parseFloat(document.getElementById("precio").value.replace(/\./g, "").replace(/\s?€/g, ""))//Eliminamos los . y € y lo convertimos a float
            const imagen = document.getElementById("imagen").value

            fetch("http://localhost:4050/vehiculos",{
                method:"POST",
                headers:{"Content-Type":"application/json"},
                body:JSON.stringify({marca,modelo,anyo,tipo,kilometraje,precio,imagen})
            })
            .then(function(respuestaTextoPlano){
                return respuestaTextoPlano.json()
            })
            .then(function(data){
                console.log(data)
                Swal.fire({
                        title: "¡Insertado!",
                        text: "¡Vehiculo creado con éxito!",
                        icon: "success"
                    })
                    .then(function(){
                        window.location.href="./vehiculos.html"
                    })
            })
            .catch(function(error){
                    console.log(error)
                    Swal.fire({
                        title: "¡Error!",
                        text: error,
                        icon: "error"
                    });
                })
        }
    </script>
</body>
</html>